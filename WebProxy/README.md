**Описание алгоритма кэширования HTTP-прокси**

Разработанный HTTP-прокси реализует простой, но эффективный алгоритм кэширования с целью уменьшения задержек при повторных запросах к одним и тем же веб-ресурсам и снижения нагрузки на внешние серверы. Алгоритм основан на стратегии **кэширования по принципу «сохранить всё при первом запросе»** (cache-on-first-use) с использованием файловой системы в качестве хранилища.

---

### Общая логика работы

При получении HTTP-запроса от клиента (поддерживается только метод `GET`) прокси-сервер выполняет следующие шаги:

1. **Нормализация URL**  
   Абсолютный URL извлекается из запроса. Если клиент отправляет относительный путь (например, `GET /example.com/index.html`), он преобразуется в абсолютную форму (`http://example.com/index.html`).

2. **Формирование ключа кэша**  
   URL преобразуется в допустимое имя файла путём замены специальных символов (`/`, `:`, `?`, `&`) на подчёркивания. Полученное имя используется как путь к файлу в директории `cache/`. Например:
   ```
   http://example.com/page?lang=ru → cache/http__example.com_page_lang_ru
   ```

3. **Проверка наличия в кэше (Cache Lookup)**  
   Сервер проверяет существование файла с таким именем в директории кэша:
    - **Если файл существует** — происходит **Cache Hit**. Содержимое файла считывается блоками фиксированного размера (8192 байт) и отправляется клиенту без обращения к внешнему серверу.
    - **Если файл отсутствует** — происходит **Cache Miss**. Сервер инициирует подключение к целевому хосту и пересылает оригинальный запрос.

4. **Запрос и кэширование при Cache Miss**  
   При промахе прокси:
    - Парсит URL на хост и путь;
    - Устанавливает TCP-соединение с хостом по порту 80 (стандартный HTTP-порт);
    - Отправляет сформированный HTTP-запрос с заголовками `Host` и `Connection: close`;
    - Получает ответ от сервера **постепенно**, сразу пересылая каждый полученный блок клиенту;
    - Одновременно записывает каждый блок в новый файл кэша.

5. **Завершение**  
   После получения всего ответа соединения с клиентом и внешним сервером закрываются. Кэш-файл сохраняется на диске и будет использован при следующем обращении к тому же URL.

---

### Особенности и ограничения

- **Тип кэша**: Write-through (данные сразу записываются в кэш при получении) и non-invalidating (кэш не обновляется автоматически — однажды сохранённый ответ используется вечно).
- **Хранилище**: Файловая система. Все ответы сохраняются как бинарные файлы, что позволяет кэшировать как HTML, так и изображения или другие бинарные данные.
- **Поддержка HTTP**: Только HTTP/1.x без TLS (HTTPS не поддерживается).
- **Безопасность**: Кэшируются **все** успешные ответы, включая частные или изменяющиеся данные. В реальных системах требуется учитывать HTTP-заголовки (`Cache-Control`, `Expires`, `ETag` и др.), но в данном алгоритме они игнорируются.
- **Потокобезопасность**: Реализация однопоточная — одновременно обрабатывается только один клиент. При параллельном использовании возможны гонки при записи в кэш.

